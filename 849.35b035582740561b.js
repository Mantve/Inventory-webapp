"use strict";(self.webpackChunkInventory_webapp=self.webpackChunkInventory_webapp||[]).push([[849],{3849:(j,A,m)=>{m.r(A),m.d(A,{AuthenticationModule:()=>D});var g=m(9808),c=m(2382);function U(t,a){return r=>{const n=r.controls[a];n.errors&&!n.errors.mustMatch||n.setErrors(r.controls[t].value!==n.value?{mustMatch:!0}:null)}}var e=m(1223),T=m(7579);function v(t){this.message=t}(v.prototype=new Error).name="InvalidCharacterError";var C="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var a=String(t).replace(/=+$/,"");if(a.length%4==1)throw new v("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,n=0,s=0,i="";o=a.charAt(s++);~o&&(r=n%4?64*r+o:o,n++%4)?i+=String.fromCharCode(255&r>>(-2*n&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return i};function f(t){this.message=t}(f.prototype=new Error).name="InvalidTokenError";const Z=function I(t,a){if("string"!=typeof t)throw new f("Invalid token specified");var r=!0===(a=a||{}).header?0:1;try{return JSON.parse(function _(t){var a=t.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(C(a).replace(/(.)/g,function(o,n){var s=n.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(r){return C(a)}}(t.split(".")[r]))}catch(o){throw new f("Invalid token specified: "+o.message)}};var q=m(520),y=m(4766);let S=(()=>{class t{constructor(){this.urlAddress=y.N.urlAddress}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),k=(()=>{class t{constructor(r,o){this.document=r,this.platformId=o,this.documentIsAccessible=(0,g.NF)(this.platformId)}static getCookieRegExp(r){const o=r.replace(/([\[\]\{\}\(\)\|\=\;\+\?\,\.\*\^\$])/gi,"\\$1");return new RegExp("(?:^"+o+"|;\\s*"+o+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(r){try{return decodeURIComponent(r)}catch(o){return r}}check(r){return!!this.documentIsAccessible&&(r=encodeURIComponent(r),t.getCookieRegExp(r).test(this.document.cookie))}get(r){if(this.documentIsAccessible&&this.check(r)){r=encodeURIComponent(r);const n=t.getCookieRegExp(r).exec(this.document.cookie);return n[1]?t.safeDecodeURIComponent(n[1]):""}return""}getAll(){if(!this.documentIsAccessible)return{};const r={},o=this.document;return o.cookie&&""!==o.cookie&&o.cookie.split(";").forEach(n=>{const[s,i]=n.split("=");r[t.safeDecodeURIComponent(s.replace(/^ /,""))]=t.safeDecodeURIComponent(i)}),r}set(r,o,n,s,i,l,h){if(!this.documentIsAccessible)return;if("number"==typeof n||n instanceof Date||s||i||l||h)return void this.set(r,o,{expires:n,path:s,domain:i,secure:l,sameSite:h||"Lax"});let d=encodeURIComponent(r)+"="+encodeURIComponent(o)+";";const u=n||{};u.expires&&(d+="number"==typeof u.expires?"expires="+new Date((new Date).getTime()+1e3*u.expires*60*60*24).toUTCString()+";":"expires="+u.expires.toUTCString()+";"),u.path&&(d+="path="+u.path+";"),u.domain&&(d+="domain="+u.domain+";"),!1===u.secure&&"None"===u.sameSite&&(u.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${r} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),u.secure&&(d+="secure;"),u.sameSite||(u.sameSite="Lax"),d+="sameSite="+u.sameSite+";",this.document.cookie=d}delete(r,o,n,s,i="Lax"){if(!this.documentIsAccessible)return;const l=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(r,"",{expires:l,path:o,domain:n,secure:s,sameSite:i})}deleteAll(r,o,n,s="Lax"){if(!this.documentIsAccessible)return;const i=this.getAll();for(const l in i)i.hasOwnProperty(l)&&this.delete(l,r,o,n,s)}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(g.K0),e.LFG(e.Lbi))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),b=(()=>{class t{constructor(r,o,n){this._http=r,this._envUrl=o,this.cookieService=n,this._authChangeSub=new T.x,this.authChanged=this._authChangeSub.asObservable(),this.registerUser=(s,i)=>this._http.post(this.createCompleteRoute(s,this._envUrl.urlAddress),i,{observe:"response",withCredentials:!0}),this.sendAuthStateChangeNotification=s=>{this._authChangeSub.next(s)},this.createCompleteRoute=(s,i)=>`${i}/${s}`,this.loginUser=(s,i)=>this._http.post(this.createCompleteRoute(s,this._envUrl.urlAddress),i,{observe:"response",withCredentials:!0}),this.logout=s=>(this.sendAuthStateChangeNotification(!1),this._http.post(this.createCompleteRoute(s,this._envUrl.urlAddress),"",{observe:"response",withCredentials:!0})),this.getUser=s=>this._http.get(this.createCompleteRoute(s,this._envUrl.urlAddress),{observe:"response",withCredentials:!0}),this.getRole=()=>{let s=this.cookieService.get("jwt");return s?Z(s)["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:""},this.getName=()=>{let s=this.cookieService.get("jwt");return s?Z(s)["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"]:""},this.isLogged=()=>{let s=this.cookieService.get("jwt");if(!s||""==s)return console.log("no token found"),!1;let i=Z(s).exp;return!(!i||Number(i)<(new Date).getTime()/1e3)||(console.log("expired "+Number(i)+"<"+(new Date).getTime()/1e3),!1)}}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(q.eN),e.LFG(S),e.LFG(k))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var p=m(7979);function x(t,a){if(1&t&&(e.TgZ(0,"div",16),e._uU(1),e.qZA()),2&t){const r=e.oxw();e.xp6(1),e.hij(" ",r.errorMessage," ")}}function E(t,a){1&t&&(e.TgZ(0,"em"),e._uU(1,"Password is required"),e.qZA())}function N(t,a){1&t&&(e.TgZ(0,"em"),e._uU(1,"Passwords do not match"),e.qZA())}function F(t,a){1&t&&(e.TgZ(0,"em"),e._uU(1,"Password is required"),e.qZA())}let R=(()=>{class t{constructor(r,o,n,s){this.formBuilder=r,this._authService=o,this._router=n,this._route=s,this.errorMessage="",this.validateControl=i=>this.registerForm.controls[i].invalid&&this.registerForm.controls[i].touched,this.hasError=(i,l)=>this.registerForm.controls[i].hasError(l),this.registerUser=i=>{this.showError=!1;const l=Object.assign({},i);this._authService.registerUser("api/register",{username:l.username,password:l.password}).subscribe(d=>{200===d.status&&this._router.navigate(["/authentication/login"])},d=>{this.errorMessage="An error has occured",this.showError=!0})}}ngOnInit(){this._returnUrl=this._route.snapshot.queryParams.returnUrl||"/",this.registerForm=this.formBuilder.group({username:new c.NI("",[c.kI.required,c.kI.maxLength(15),c.kI.pattern("^[a-zA-Z ]*$")]),password:new c.NI("",[c.kI.required]),confirm:new c.NI("",[c.kI.required])},{validator:U("password","confirm")})}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(c.qu),e.Y36(b),e.Y36(p.F0),e.Y36(p.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-register"]],decls:31,vars:6,consts:[[1,"card"],[1,"card-body"],[1,"card-title"],["class","alert alert-danger","role","alert",4,"ngIf"],["autocomplete","off","novalidate","",3,"formGroup","ngSubmit"],[1,"form-group","row"],["for","username",1,"col-form-label","col-sm-2"],[1,"col-md-5"],["type","text","id","username","formControlName","username",1,"form-control"],["for","password",1,"col-form-label","col-sm-2"],["type","password","id","password","formControlName","password",1,"form-control"],[4,"ngIf"],["for","confirm",1,"col-form-label","col-sm-2"],["type","password","id","confirm","formControlName","confirm",1,"form-control"],[1,"col-md-1"],["type","submit",1,"btn","btn-info",3,"disabled"],["role","alert",1,"alert","alert-danger"]],template:function(r,o){1&r&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h1",2),e._uU(3,"Register"),e.qZA(),e.YNc(4,x,2,1,"div",3),e.TgZ(5,"form",4),e.NdJ("ngSubmit",function(){return o.registerUser(o.registerForm.value)}),e.TgZ(6,"div",5),e.TgZ(7,"label",6),e._uU(8,"Username:"),e.qZA(),e.TgZ(9,"div",7),e._UZ(10,"input",8),e.qZA(),e.qZA(),e.TgZ(11,"div",5),e.TgZ(12,"label",9),e._uU(13,"Password:"),e.qZA(),e.TgZ(14,"div",7),e._UZ(15,"input",10),e.qZA(),e.TgZ(16,"div",7),e.YNc(17,E,2,0,"em",11),e.qZA(),e.qZA(),e.TgZ(18,"div",5),e.TgZ(19,"label",12),e._uU(20,"Confirm Password:"),e.qZA(),e.TgZ(21,"div",7),e._UZ(22,"input",13),e.qZA(),e.TgZ(23,"div",7),e.YNc(24,N,2,0,"em",11),e.YNc(25,F,2,0,"em",11),e.qZA(),e.qZA(),e._UZ(26,"br"),e.TgZ(27,"div",5),e.TgZ(28,"div",14),e.TgZ(29,"button",15),e._uU(30,"Register"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r&&(e.xp6(4),e.Q6J("ngIf",o.showError),e.xp6(1),e.Q6J("formGroup",o.registerForm),e.xp6(12),e.Q6J("ngIf",o.validateControl("password")&&o.hasError("password","required")),e.xp6(7),e.Q6J("ngIf",o.validateControl("confirm")&&o.hasError("confirm","mustMatch")),e.xp6(1),e.Q6J("ngIf",o.validateControl("confirm")&&o.hasError("confirm","required")),e.xp6(4),e.Q6J("disabled",!o.registerForm.valid))},directives:[g.O5,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u],styles:[""]}),t})();function L(t,a){if(1&t&&(e.TgZ(0,"div",14),e._uU(1),e.qZA()),2&t){const r=e.oxw();e.xp6(1),e.hij(" ",r.errorMessage," ")}}function J(t,a){1&t&&(e.TgZ(0,"em"),e._uU(1,"Username is required"),e.qZA())}function M(t,a){1&t&&(e.TgZ(0,"em"),e._uU(1,"Password is required"),e.qZA())}let Y=(()=>{class t{constructor(r,o,n){this._authService=r,this._router=o,this._route=n,this.errorMessage="",this.validateControl=s=>this.loginForm.controls[s].invalid&&this.loginForm.controls[s].touched,this.hasError=(s,i)=>this.loginForm.controls[s].hasError(i),this.loginUser=s=>{this.showError=!1;const i=Object.assign({},s);this._authService.loginUser("api/login",{username:i.username,password:i.password}).subscribe(h=>{this._authService.sendAuthStateChangeNotification(200===h.status),this._router.navigate([this._returnUrl])},h=>{this.errorMessage="An error has occured",this.showError=!0})}}ngOnInit(){this.loginForm=new c.cw({username:new c.NI("",[c.kI.required]),password:new c.NI("",[c.kI.required])}),this._returnUrl=this._route.snapshot.queryParams.returnUrl||"/"}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(b),e.Y36(p.F0),e.Y36(p.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-login"]],decls:25,vars:5,consts:[[1,"card"],[1,"card-body"],[1,"card-title"],["class","alert alert-danger","role","alert",4,"ngIf"],["autocomplete","off","novalidate","",3,"formGroup","ngSubmit"],[1,"form-group","row"],["for","username",1,"col-form-label","col-sm-2"],[1,"col-md-5"],["type","text","id","username","formControlName","username",1,"form-control"],[4,"ngIf"],["for","password",1,"col-form-label","col-sm-2"],["type","password","id","password","formControlName","password",1,"form-control"],[1,"col-md-1"],["type","submit",1,"btn","btn-info",3,"disabled"],["role","alert",1,"alert","alert-danger"]],template:function(r,o){1&r&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e.TgZ(2,"h1",2),e._uU(3,"Login"),e.qZA(),e.YNc(4,L,2,1,"div",3),e.TgZ(5,"form",4),e.NdJ("ngSubmit",function(){return o.loginUser(o.loginForm.value)}),e.TgZ(6,"div",5),e.TgZ(7,"label",6),e._uU(8,"Username:"),e.qZA(),e.TgZ(9,"div",7),e._UZ(10,"input",8),e.qZA(),e.TgZ(11,"div",7),e.YNc(12,J,2,0,"em",9),e.qZA(),e.qZA(),e.TgZ(13,"div",5),e.TgZ(14,"label",10),e._uU(15,"Password:"),e.qZA(),e.TgZ(16,"div",7),e._UZ(17,"input",11),e.qZA(),e.TgZ(18,"div",7),e.YNc(19,M,2,0,"em",9),e.qZA(),e.qZA(),e._UZ(20,"br"),e.TgZ(21,"div",5),e.TgZ(22,"div",12),e.TgZ(23,"button",13),e._uU(24,"Login"),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&r&&(e.xp6(4),e.Q6J("ngIf",o.showError),e.xp6(1),e.Q6J("formGroup",o.loginForm),e.xp6(7),e.Q6J("ngIf",o.validateControl("username")&&o.hasError("username","required")),e.xp6(7),e.Q6J("ngIf",o.validateControl("password")&&o.hasError("password","required")),e.xp6(4),e.Q6J("disabled",!o.loginForm.valid))},directives:[g.O5,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u],styles:[""]}),t})(),D=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.ez,c.UX,p.Bz.forChild([{path:"register",component:R},{path:"login",component:Y}])]]}),t})()}}]);